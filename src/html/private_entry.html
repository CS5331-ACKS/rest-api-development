<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/bootstrap-table.min.css"/>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/bootstrap-table.min.js"></script>



<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <ul class="navbar-nav">
    <li class="nav-item active">
      <a class="nav-link" id="public_entry_auth" href="#">View public diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="create_entry" href="#">Create new diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="delete_entry" href="#">Delete existing diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="adjust_entry" href="#">Adjust diary entry permissions</a>
    </li>
  </ul>
  <ul class="nav navbar-nav ml-auto">
    <li class="nav-item active">
      <a class="nav-link" id="logout" href="#">Logout</a>
    </li>
  </ul>
</nav>
</body>
</html>


<br></br><h1 class="text-left">Private Diary Entry</h1>


<table class="table" id="mytable">
<thead>
<tr>
  <th>Id</th>
  <th>Title</th>
  <th>Author</th>
  <th>Publish Date</th>
  <th>Public</th>
  <th>Text</th>
</tr>
</thead>
</table>


<script type="text/javascript">

  var token = window.location.search.substr(1);
  var formToken = `{\"token\": "${token}"}`;


          $.ajax({
              url: 'http://localhost:8080/diary',
              type : "POST",
              contentType: "application/json",
              data : formToken,
              dataType: 'json',
              success: function(data) {

                  if (data.status == false)
                  {
                    alert("Invalid authentication token.");
                    window.location.href = "index.html";
                  }

                  for (var i=0; i<data.result.length; i++) {
                      var row = $('<tr><td>' + data.result[i].id + '</td><td>' + data.result[i].title + '</td><td>' + data.result[i].author + '</td><td>' + data.result[i].publish_date + '</td><td>' + data.result[i].public + '</td><td>' +data.result[i].text + '</td><td>' + '</td></tr>');
                      $('#mytable').append(row);

                  }

              },
              error: function(jqXHR, textStatus, errorThrown){
                  alert('Error: ' + textStatus + ' - ' + errorThrown);
              }
          });

          $("#public_entry_auth").click(function() {
            window.location.href = `public_entry_auth.html?${token}`;
          });

          $("#create_entry").click(function() {
          window.location.href = `create_entry.html?${token}`;
          });

          $("#delete_entry").click(function() {
          window.location.href = `delete_entry.html?${token}`;
          });

          $("#adjust_entry").click(function() {
          window.location.href = `adjust_entry.html?${token}`;
          });

    $("#logout").on('click', function(){

        // send ajax
        $.ajax({
            url: 'http://localhost:8080/users/expire', // url where to submit the request
            type : "POST", // type of action POST || GET
            dataType : 'json', // data type
            data : formToken,
            contentType: "application/json",
            success : function(result) {


                if (result.status == true)
                {
                  alert("Successfully logged out!");
                  window.location.href = "index.html";

                }
                else if (result.status == false)
                {
                  alert("Already logged out!");
                  window.location.href = "index.html";
                }
            },
            error: function(xhr, resp, text) {
                console.log(xhr, resp, text);
            }
        })


    });
</script>
