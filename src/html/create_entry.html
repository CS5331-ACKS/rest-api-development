<link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/bootstrap/bootstrap-table.min.css"/>
<script src="/js/jquery/jquery.min.js"></script>
<script src="/js/bootstrap/bootstrap.min.js"></script>
<script src="/js/bootstrap/bootstrap-table.min.js"></script>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <ul class="navbar-nav">
    <li class="nav-item active">
      <a class="nav-link" id="public_entry_auth" href="#">View public diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="private_entry" href="#">View private diary entries</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="delete_entry" href="#">Delete existing diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="adjust_entry" href="#">Adjust diary entry permissions</a>
    </li>
  </ul>
  <ul class="nav navbar-nav ml-auto">
    <li class="nav-item active">
      <a class="nav-link" id="logout" href="#">Logout</a>
    </li>
  </ul>
</nav>
</body>
</html>


<html>

<div class="container py-5">
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6 mx-auto">
                    <span class="anchor" id="formCreate"></span>
                    <!-- form card login -->
                    <div class="card rounded-0">
                        <div class="card-header">
                            <h3 class="mb-0">Create new diary entry</h3>
                        </div>

                        <div class="card-body">
                            <form class="form" role="form" autocomplete="off" id="formCreateDiary" method="post">
                                <div class="form-group">
                                    <label>Title</label>
                                    <input type="text" class="form-control form-control-lg rounded-0" name="title" id="titleId" placeholder="Input diary title here" required>
                                </div>
                                <div class="form-group">
                                    <label>Text</label>
                                    <input type="text" class="form-control form-control-lg rounded-0" name="text" id="textId" placeholder="Input diary text here" required>
                                </div>
                                    <input type="submit" id="submit" class="btn btn-success btn-lg float-right" value="Submit">

                            </form>
                        </div>
                        <!--/card-block-->
                    </div>
                    <!-- /form card login -->

                </div>


            </div>
            <!--/row-->

        </div>
        <!--/col-->
    </div>
    <!--/row-->
</div>
<!--/container-->

<script type="text/javascript">

$(document).ready(function(){

  var token = window.localStorage.getItem('token');
  var formToken = `{\"token\": "${token}"}`;

  $("#submit").on('click', function(e){

    e.preventDefault();
    e.returnValue = false;

    var titleVar = document.getElementById("titleId").value;
    var textVar = document.getElementById("textId").value;
    var create_entry_json =  `{\"token\": "${token}",\"title\": "${titleVar}",\"public\": false,\"text\": "${textVar}"}`;

    if (document.getElementById("titleId").value == "" || document.getElementById("textId").value == "")
    {
      alert("Please fill up all the fields");
      return;
    }
      // send ajax
      $.ajax({
          url: 'http://localhost:8080/diary/create', // url where to submit the request
          type : "POST", // type of action POST || GET
          dataType : 'json', // data type
          data : create_entry_json,
          contentType: "application/json",
          success : function(result) {

              console.log(result);

              if (result.status == true)
              {
                alert("New diary entry created!");

              }
              else if (result.status == false)
              {
                alert("Invalid authentication token.");
                window.location.href = "index.html";
              }
          },
          error: function(xhr, resp, text) {
              console.log(xhr, resp, text);
          }
      })


  });
          $("#public_entry_auth").click(function() {
          window.location.href = 'public_entry_auth.html';
          });

          $("#private_entry").click(function() {
          window.location.href = 'private_entry.html';
          });

          $("#delete_entry").click(function() {
          window.location.href = 'delete_entry.html';
          });

          $("#adjust_entry").click(function() {
          window.location.href = 'adjust_entry.html';
          });

    $("#logout").on('click', function(){

        // send ajax
        $.ajax({
            url: 'http://localhost:8080/users/expire', // url where to submit the request
            type : "POST", // type of action POST || GET
            dataType : 'json', // data type
            data : formToken,
            contentType: "application/json",
            success : function(result) {

                console.log(result);

                if (result.status == true)
                {
                  alert("Successfully logged out!");
                  window.localStorage.removeItem('token');
                  window.location.href = "index.html";

                }
                else if (result.status == false)
                {
                  alert("Already logged out!");
                  window.localStorage.removeItem('token');
                  window.location.href = "index.html";
                }
            },
            error: function(xhr, resp, text) {
                console.log(xhr, resp, text);
            }
        })


    });
  });
</script>


</html>
