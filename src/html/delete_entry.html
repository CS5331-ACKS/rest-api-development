<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/bootstrap-table.min.css"/>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/bootstrap-table.min.js"></script>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <ul class="navbar-nav">
    <li class="nav-item active">
      <a class="nav-link" id="public_entry_auth" href="#">View public diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="private_entry" href="#">View private diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="create_entry" href="#">Create diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="adjust_entry" href="#">Adjust diary entry permissions</a>
    </li>
  </ul>
  <ul class="nav navbar-nav ml-auto">
    <li class="nav-item active">
      <a class="nav-link" id="logout" href="#">Logout</a>
    </li>
  </ul>
</nav>
</body>
</html>


<html>
<head>

<div class="container py-5">
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6 mx-auto">
                    <span class="anchor" id="formDelete"></span>
                    <!-- form card login -->
                    <div class="card rounded-0">
                        <div class="card-header">
                            <h3 class="mb-0">Delete existing diary entry</h3>
                        </div>

                        <div class="card-body">
                            <form class="form" role="form" autocomplete="off" id="formDeleteDiary" method="post">
                                <div class="form-group">
                                    <label>Title ID</label>
                                    <input type="text" class="form-control form-control-lg rounded-0" name="Id" id="titleId" placeholder="Input title id here" required>
                                </div>
                                    <input type="submit" id="submit" class="btn btn-success btn-lg float-right" value="Submit">

                            </form>
                        </div>
                        <!--/card-block-->
                    </div>
                    <!-- /form card login -->

                </div>


            </div>
            <!--/row-->

        </div>
        <!--/col-->
    </div>
    <!--/row-->
</div>
<!--/container-->

<table class="table" id="mytable">
<thead>
<tr>
  <th>Id</th>
  <th>Title</th>
  <th>Author</th>
  <th>Publish Date</th>
  <th>Public</th>
  <th>Text</th>
</tr>
</thead>
</table>

<script type="text/javascript">

$(document).ready(function(){

  var token = window.location.search.substr(1);
  var formToken = `{\"token\": "${token}"}`;

  $("#submit").on('click', function(e){

    e.preventDefault();
    e.returnValue = false;

    var titleVar = document.getElementById("titleId").value;
    var delete_entry_json =  `{\"token\": "${token}",\"id\": ${titleVar}}`;

    if (document.getElementById("titleId").value == "")
    {
      alert("Please fill up all the fields");
      return;
    }

      // send ajax
      $.ajax({
          url: 'http://localhost:8080/diary/delete', // url where to submit the request
          type : "POST", // type of action POST || GET
          dataType : 'json', // data type
          data : delete_entry_json,
          contentType: "application/json",
          success : function(result) {

              console.log(result);

              if (result.status == true)
              {
                alert("Diary entry deleted!");
                location.reload();

              }
              else if (result.status == false)
              {
                 alert("Invalid diary title ID/authentication token");
              }
          },
          error: function(xhr, resp, text) {
              console.log(xhr, resp, text);
          }
      })

  });

  $.ajax({
      url: 'http://localhost:8080/diary',
      type : "POST",
      contentType: "application/json",
      data : formToken,
      dataType: 'json',
      success: function(data) {

          if (data.status == false)
          {
            alert("Invalid authentication token.");
            window.location.href = "index.html";
          }

          for (var i=0; i<data.result.length; i++) {
              var row = $('<tr><td>' + data.result[i].id + '</td><td>' + data.result[i].title + '</td><td>' + data.result[i].author + '</td><td>' + data.result[i].publish_date + '</td><td>' + data.result[i].public + '</td><td>' + data.result[i].text + '</td><td>' + '</td></tr>');
              $('#mytable').append(row);

          }

      },
      error: function(jqXHR, textStatus, errorThrown){
          alert('Error: ' + textStatus + ' - ' + errorThrown);
      }
  });

          $("#public_entry_auth").click(function() {
          window.location.href = `public_entry_auth.html?${token}`;
          });

          $("#private_entry").click(function() {
          window.location.href = `private_entry.html?${token}`;
          });

          $("#create_entry").click(function() {
          window.location.href = `create_entry.html?${token}`;
          });

          $("#adjust_entry").click(function() {
          window.location.href = `adjust_entry.html?${token}`;
          });

    $("#logout").on('click', function(){

        // send ajax
        $.ajax({
            url: 'http://localhost:8080/users/expire', // url where to submit the request
            type : "POST", // type of action POST || GET
            dataType : 'json', // data type
            data : formToken,
            contentType: "application/json",
            success : function(result) {

                console.log(result);

                if (result.status == true)
                {
                  alert("Successfully logged out!");
                  window.location.href = "index.html";

                }
                else if (result.status == false)
                {
                  alert("Already logged out!");
                  window.location.href = "index.html";
                }
            },
            error: function(xhr, resp, text) {
                console.log(xhr, resp, text);
            }
        })


    });
  });
</script>


</html>
