<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/bootstrap-table.min.css"/>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/bootstrap-table.min.js"></script>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <ul class="navbar-nav">
    <li class="nav-item active">
      <a class="nav-link" id="private_entry" href="#">View private diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="create_entry" href="#">Create diary entry</a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" id="delete_entry" href="#">Delete existing diary entry</a>
    </li>
  </ul>
  <ul class="nav navbar-nav ml-auto">
    <li class="nav-item active">
      <a class="nav-link" id="logout" href="#">Logout</a>
    </li>
  </ul>
</nav>
</body>
</html>


<div class="container py-5">
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6 mx-auto">
                    <span class="anchor" id="formAdjust"></span>
                    <!-- form card login -->
                    <div class="card rounded-0">
                        <div class="card-header">
                            <h3 class="mb-0">Adjust diary entry permission</h3>
                        </div>

                        <div class="card-body">
                            <form class="form" role="form" autocomplete="off" id="formAdjustDiary" method="post">
                                <div class="form-group">
                                    <label>Title ID</label>
                                    <input type="text" class="form-control form-control-lg rounded-0" name="titleId" id="titleId" placeholder="Input title id here"required>
                                </div>
                                <div class="btn-group" data-toggle="buttons">
                                <label class="btn btn-secondary active">
                                  <input type="radio" name="options" id="optionPrivate" autocomplete="off" checked> Private
                                </label>
                                <label class="btn btn-secondary">
                                  <input type="radio" name="options" id="optionPublic" autocomplete="off"> Public
                                </label>
                                </div>
                                    <input type="submit" id="submit" class="btn btn-success btn-lg float-right" value="Submit">

                            </form>
                        </div>
                        <!--/card-block-->
                    </div>
                    <!-- /form card login -->

                </div>


            </div>
            <!--/row-->

        </div>
        <!--/col-->
    </div>
    <!--/row-->
</div>
<!--/container-->

<table class="table" id="mytable">
<thead>
<tr>
  <th>Id</th>
  <th>Title</th>
  <th>Author</th>
  <th>Publish Date</th>
  <th>Public</th>
  <th>Text</th>
</tr>
</thead>
</table>


<script>
    $(document).ready(function(){

      var token = window.location.search.substr(1);
      var formToken = `{\"token\": "${token}"}`;

      $("#private_entry").click(function() {
        window.location.href = `private_entry.html?${token}`;
      });

      $("#create_entry").click(function() {
        window.location.href = `create_entry.html?${token}`;
      });

      $("#delete_entry").click(function() {
        window.location.href = `delete_entry.html?${token}`;
      });

      $("#submit").on('click', function(e){

        e.preventDefault();
        e.returnValue = false;

        var titleVar = document.getElementById("titleId").value;
        var publicVar;


        if (document.getElementById("optionPrivate").checked == true)
        {
          publicVar =false;
        }
        else if (document.getElementById("optionPublic").checked == true)
        {
          publicVar = true;
        }

        var adjust_entry_json =  `{\"token\": "${token}",\"id\": ${titleVar},\"public\": ${publicVar}}`;

        if (document.getElementById("titleId").value == "")
        {
          alert("Please fill up all the fields");
          return;
        }

        $.ajax({
            url: 'http://localhost/diary/permission',
            type : "POST",
            contentType: "application/json",
            data : adjust_entry_json,
            dataType: 'json',
            success: function(data) {

              if (result.status == true)
              {
                alert("Diary entry permission adjusted!");
                location.reload();

              }
              else if (result.status == false)
              {
                alert("Invalid authentication token.");
                window.location.href = "index.html";
              }

            },
            error: function(jqXHR, textStatus, errorThrown){
                alert('Error: ' + textStatus + ' - ' + errorThrown);
            }
        });

    });

    $.ajax({
        url: 'http://localhost:8080/diary',
        type : "POST",
        contentType: "application/json",
        data : formToken,
        dataType: 'json',
        success: function(data) {

            if (data.status == false)
            {
              alert("Invalid authentication token.");
              window.location.href = "index.html";
            }

            for (var i=0; i<data.result.length; i++) {
                var row = $('<tr><td>' + data.result[i].id + '</td><td>' + data.result[i].title + '</td><td>' + data.result[i].author + '</td><td>' + data.result[i].publish_date + '</td><td>' + data.result[i].public + '</td><td>' + data.result[i].text + '</td><td>' + '</td></tr>');
                $('#mytable').append(row);

            }

        },
        error: function(jqXHR, textStatus, errorThrown){
            alert('Error: ' + textStatus + ' - ' + errorThrown);
        }
    });

    // click on button submit
   $("#logout").on('click', function(){

       // send ajax
       $.ajax({
           url: 'http://localhost:8080/users/expire', // url where to submit the request
           type : "POST", // type of action POST || GET
           dataType : 'json', // data type
           data : formToken,
           contentType: "application/json",
           success : function(result) {

               console.log(result);

               if (result.status == true)
               {
                 alert("Successfully logged out!");
                 window.location.href = "index.html";

               }
               else if (result.status == false)
               {
                 alert("Already logged out!");
                 window.location.href = "index.html";
               }
           },
           error: function(xhr, resp, text) {
               console.log(xhr, resp, text);
           }
       })
   });

     });
</script>
